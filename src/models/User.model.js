const mongoose = require(\'mongoose\');\nconst bcrypt = require(\'bcryptjs\');\nconst jwt = require(\'jsonwebtoken\');\n\nconst userSchema = new mongoose.Schema({\n  nombre: {\n    type: String,\n    required: [true, \'El nombre es obligatorio\'],\n    trim: true\n  },\n  correo: {\n    type: String,\n    required: [true, \'El correo es obligatorio\'],\n    unique: true,\n    lowercase: true,\n    trim: true,\n    match: [/^[^\s@]+@[^\s@]+\.[^\s@]+$/, \'Formato de correo inválido\']\n  },\n  password: {\n    type: String,\n    required: [true, \'La contraseña es obligatoria\'],\n    minlength: [6, \'La contraseña debe tener al menos 6 caracteres\']\n  },\n  direccion: {\n    type: String,\n    required: [true, \'La dirección es obligatoria\'],\n    trim: true\n  },\n  productosFavoritos: [{\n    nombre: String,\n    precio: Number,\n    categoria: String,\n    agregadoEn: {\n      type: Date,\n      default: Date.now\n    }\n  }],\n  rol: {\n    type: String,\n    enum: [\'usuario\', \'admin\'],\n    default: \'usuario\'\n  },\n  activo: {\n    type: Boolean,\n    default: true\n  }\n}, {\n  timestamps: true\n});\n\n// Encriptar password antes de guardar\nuserSchema.pre(\'save\', async function(next) {\n  if (!this.isModified(\'password\')) return next();\n  this.password = await bcrypt.hash(this.password, 10);\n  next();\n});\n\n// Método para comparar passwords\nuserSchema.methods.comparePassword = async function(password) {\n  return await bcrypt.compare(password, this.password);\n};\n\n// Método para generar JWT\nuserSchema.methods.generateToken = function() {\n  return jwt.sign(\n    { id: this._id, correo: this.correo, rol: this.rol },\n    process.env.JWT_SECRET,\n    { expiresIn: \'7d\' }\n  );\n};\n\nmodule.exports = mongoose.model(\'User\', userSchema);\n